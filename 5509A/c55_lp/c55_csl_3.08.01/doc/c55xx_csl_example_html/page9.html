<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>C55XX CSL 3.06.00 Examples: McBSP EXAMPLE DOCUMENTATION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">C55XX CSL 3.06.00 Examples
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">McBSP EXAMPLE DOCUMENTATION </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="McBSP5"></a>
McBSP EXAMPLE5 - 128 channel mode</h1>
<h2><a class="anchor" id="McBSP5x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the McBSP TX-RX external loopback in 128 channel mode.</p>
<h2><a class="anchor" id="McBSP5y"></a>
TEST PROCEDURE AND EXPECTED RESULT:</h2>
<p>This test configures PLL to be 100MHz</p>
<p>This is an External Loop-back Test The following connections are required on J14 of EVM5517</p>
<ol type="1">
<li>McBSP_CLKX(pin#12) to pin 20 on J15 (or) McBSP_CLKR(Test point -TP#15)</li>
<li>McBSP_FSX(pin#8) to McBSP_FSR(pin#1)</li>
<li>McBSP_DX(pin#22) to McBSP_DR(pin#21)</li>
</ol>
<p>USE_DMA macro: Uncomment this to run in DMA mode. Commenting this makes the test in POLL mode.</p>
<p>Brief description of the procedure and expected result to be checked:</p><ol type="1">
<li>Configure DMA3 Channel0: 1Word Burst, McBSP Tx Dma event, write mode, global tx array addr as src and McBSP TXRL as dst, IO-mem transfer and suitable datalength, dma interrupt enabled.</li>
<li>Configure DMA3 Channel1: 1Word Burst, McBSP Rx Dma event, read mode, McBSP RXRL as src and global rx array addr as dst, IO-mem transfer and suitable datalength, dma interrupt enabled.</li>
<li>Configure McBSP: 128 channel mode (using R/XMCME, R/XMCM, R/XEMODE, R/XCERA/B/C/D/E/F/G/H), 32 Word wordlenth, framelenth 128, single phase, 0-bit data delay, r-justified msb first, clksrc sysclk, frame sync selection, sample rate</li>
<li>Start DMA3 channels 0&amp;1</li>
<li>Enable and start McBSP Tx, Rx and Frame Sync Generator</li>
<li>Wait for Rx and Tx DMA event completion in the DMA interrupt flag register</li>
<li>Check Data in rx array for integrity vis-a-vis the tx array</li>
</ol>
<h1><a class="anchor" id="McBSP6"></a>
McBSP EXAMPLE6 - companding 32 channel</h1>
<h2><a class="anchor" id="McBSP6x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the McBSP in 32 channel mode, and companding using ALAW and MULAW.</p>
<h2><a class="anchor" id="McBSP6y"></a>
TEST PROCEDURE:</h2>
<p>This test configures PLL to be 100MHz</p>
<p>This is an External Loop-back Test The following connections are required on J14 of EVM5517</p>
<ol type="1">
<li>McBSP_CLKX(pin#12) to pin 20 on J15 (or) McBSP_CLKR(Test point -TP#15)</li>
<li>McBSP_FSX(pin#8) to McBSP_FSR(pin#1)</li>
<li>McBSP_DX(pin#22) to McBSP_DR(pin#21)</li>
</ol>
<p>USE_DMA macro: Uncomment this to run in DMA mode. Commenting this makes the test in POLL mode.</p>
<p>USE_ALAW_COMPANDING macro: Uncomment this macro to enable ALAW companding The test case transmits data with ALAW compression. The test case receiuves data with ALAW expanding. The data is externally looped back. NOTE:Please comment the macro USE_MULAW_COMPANDING</p>
<p>USE_MULAW_COMPANDING macro: Uncomment this macro to enable MULAW companding The test case transmits data with MULAW compression. The test case receiuves data with MULAW expanding. The data is externally looped back. NOTE:Please comment the macro USE_ALAW_COMPANDING</p>
<h2><a class="anchor" id="McBSP6z"></a>
TEST RESULT:</h2>
<p>Verification of xmt &amp; rcv buffers As both ALAW and MULAW compression are lossy, we cant do a byte matching to verify the results. Hence we use the Graph Tool of CCS to do a visual comparison.</p>
<p>The data transmitted is 16-bit sine wave data. The graph plotted with this will be a sine wave.</p>
<p>***The verification involves plotting graphs from xmt &amp; rcv buffer &amp; doing a VISUAL comparison***</p>
<p>How to plot the graph using CCS Graph Tool:</p><ol type="1">
<li>Open the Graph Tool with View-&gt;Graph-&gt;Time/Frequency</li>
<li>Use the below configuration on the Graph Property Dialog</li>
<li>Give 'xmt' as the 'Start Address'. Click OK</li>
<li>Right click and select 'Auto Scale'. NOTE:If you do not see Auto Scale, it means that you are already on 'Auto Scale'</li>
<li>Open the Graph Tool again as in Step-1 &amp; Use the same configuration</li>
<li>Give 'rcv' as the 'Start Address'. Click OK</li>
<li>Right click and select 'Auto Scale' as in Step-4</li>
<li>Compare both the graphs side-by-side</li>
</ol>
<p>Graph Property Dialog Configuration</p>
<p>Display Type - Single Time Graph Title - Graphical Display Start Address - Page - DATA Acquisition Buffer Size - 1024 Index Increment - 1 Display Data Size - 1024 DSP Data Type - 16-bit signed integer Q-value - 0 Sampling Rate (Hz) - 1 Plot Data From - Left To Right Left-shifted Data Display - Yes Autoscale - On DC Value - 0 Axes Display - On Time Display Unit - s Status Bar Display - On Magnitude Display Scale - Linear Data Plot Style - Line Grid Style - Zero Line Cursor Mode - No Cursor</p>
<h1><a class="anchor" id="McBSP7"></a>
McBSP EXAMPLE7 - McBSP DMA mode</h1>
<h2><a class="anchor" id="McBSP7x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the McBSP external loopback TX-RX transfers using DMA.</p>
<h2><a class="anchor" id="McBSP7y"></a>
TEST PROCEDURE AND EXPECTED RESULT:</h2>
<p>Uncomment "#define EVM5525 1" &amp; Comment "#define USE_MCBSP_TARGET 1" This test configures PLL to be 100MHz</p>
<p>This is an External Loop-back Test The following connections are required on J14 of EVM5517 revD</p>
<ol type="1">
<li>McBSP_CLKX(pin#12) to pin 20 on J15 (or) McBSP_CLKR(Test point -TP#15)</li>
<li>McBSP_FSX(pin#8) to McBSP_FSR(pin#1)</li>
<li>McBSP_DX(pin#22) to McBSP_DR(pin#21)</li>
</ol>
<p>Brief description of the procedure and the expected result to be checked:</p><ol type="1">
<li>Configure DMA3 Channel0: 1Word Burst, McBSP Tx Dma event, write mode, global tx array addr as src and McBSP TXRL as dst, IO-mem transfer i and suitable datalength, dma interrupt enabled.</li>
<li>Configure DMA3 Channel1: 1Word Burst, McBSP Rx Dma event, read mode, i McBSP RXRL as src and global rx array addr as dst, IO-mem transfer and i suitable datalength, dma interrupt enabled.</li>
<li>Configure McBSP: 32 Word wordlenth, framelenth 1, single phase, 0-bit data delay, i r-justified msb first, clksrc sysclk, frame sync selection, sample rate</li>
<li>Start DMA3 channels 0&amp;1</li>
<li>Enable and start McBSP Tx, Rx and Frame Sync Generator</li>
<li>Wait for Rx and Tx DMA event completion in the DMA interrupt flag register</li>
<li>Check Data in rx array for integrity vis-a-vis the tx array</li>
</ol>
<h1><a class="anchor" id="McBSP8"></a>
McBSP EXAMPLE8 - McBSP IDLE function</h1>
<h2><a class="anchor" id="McBSP8x"></a>
TEST DESCRIPTION:</h2>
<p>This test verifies McBSP TX-RX external loopback in McBSP-IDLE_EN bit set in PCRL</p>
<h2><a class="anchor" id="McBSP8y"></a>
TEST PROCEDURE AND EXPECTED RESULT:</h2>
<p>This test configures PLL to be 100MHz</p>
<p>This is an External Loop-back Test The following connections are required on J14 of EVM5517</p>
<ol type="1">
<li>McBSP_CLKX(pin#12) to pin 20 on J15 (or) McBSP_CLKR(Test point -TP#15)</li>
<li>McBSP_FSX(pin#8) to McBSP_FSR(pin#1)</li>
<li>McBSP_DX(pin#22) to McBSP_DR(pin#21)</li>
</ol>
<p>Brief description of the procedure and the expected result to be checked:</p><ol type="1">
<li>Configure McBSP: 32 Word wordlenth, framelenth 1, single phase, 0-bit data delay, r-justified msb first, clksrc sysclk, frame sync selection, sample rate.</li>
<li>Enable and start McBSP Tx, Rx and Frame Sync Generator.</li>
<li>Set IDLE_EN in PCRL.</li>
<li>Wait for XRDY bit in SPCRU to be set.</li>
<li>Send data in xmt[] out of McBSP Tx via DXRU and DXRL.</li>
<li>Wait for RRDY bit in SPCRL to be set.</li>
<li>Collect the data rfom RXRU and RXRL into rcv[].</li>
<li>Check Data in rcv array for integrity vis-a-vis the xmt array.</li>
</ol>
<h1><a class="anchor" id="McBSP4"></a>
McBSP EXAMPLE4 - McBSP Interrupt mode</h1>
<h2><a class="anchor" id="McBSP4x"></a>
TEST DESCRIPTION:</h2>
<p>This test verifies TX-RX McBSP external loopback transfers using MCBSP TX and RX interrupts.</p>
<h2><a class="anchor" id="McBSP4y"></a>
TEST PROCEDURE AND EXPECTED RESULT:</h2>
<p>This test configures PLL to be 100MHz</p>
<p>This is an External Loop-back Test The following connections are required on J14 of EVM5517</p>
<ol type="1">
<li>McBSP_CLKX(pin#12) to pin 20 on J15 (or) McBSP_CLKR(Test point -TP#15)</li>
<li>McBSP_FSX(pin#8) to McBSP_FSR(pin#1)</li>
<li>McBSP_DX(pin#22) to McBSP_DR(pin#21)</li>
</ol>
<p>Brief description of the procedure and the expected result to be checked:</p>
<p>0. Configure and enable interrupts PROG0 and PROG1 doe McBSP Tx and Rx ISR's.</p><ol type="1">
<li>Configure McBSP: 32 Word wordlenth, framelenth 1, single phase, 0-bit data delay, r-justified msb first, clksrc sysclk, frame sync selection, sample rate.</li>
<li>Enable and start McBSP Tx, Rx and Frame Sync Generator.</li>
<li>Wait for McBSP Tx interrupt.</li>
<li>Send data in xmt[] out of McBSP Tx via DXRU and DXRL.</li>
<li>Wait McBSP Rx interrupt.</li>
<li>Collect the data rfom RXRU and RXRL into rcv[].</li>
<li>Check Data in rcv array for integrity vis-a-vis the xmt array.</li>
</ol>
<h1><a class="anchor" id="McBSP1"></a>
McBSP EXAMPLE1 - INTERNAL LOOPBACK TEST</h1>
<h2><a class="anchor" id="McBSP1x"></a>
TEST DESCRIPTION:</h2>
<p>This test verifies the operation of the C5517 McBSP (Multichannel Buffered Serial Port) module in loopback mode. In loopback mode the McBSP module does not communicate with any slave device. Internally the McBSP transmit register will be connected to the McBSP receive register. Any data copied to the McBSP transmitted data will be transmitted to the McBSP receive registers. Loopback mode is helpful to verify the McBSP data and shift registers and internals data paths.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSION C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="McBSP1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5517 EVM) </li>
<li>Open the project "CSL_McBSP_InternalLB.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at the following PLL frequencies C5517: 60MHz, 100MHz, 150MHz and 200MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="McBSP1z"></a>
TEST RESULT:</h2>
<ul>
<li>All the CSL APIs should return success </li>
<li>Read and write data buffer comparison should be successful. <hr/>
</li>
</ul>
<h1><a class="anchor" id="McBSP3"></a>
McBSP EXAMPLE3 - Audio DMA mode</h1>
<h2><a class="anchor" id="McBSP3x"></a>
TEST DESCRIPTION:</h2>
<p>This test verifies the operation of the C5517 McBSP (Multichannel Buffered Serial Port) module in DMA mode along with the AIC3204.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSION C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="McBSP3y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5517 EVM) </li>
<li>Open the project "CSL_McBSP_Master_AIC3204_48kbps_DMA.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Connect the audio source to J9 (stereo in 1) </li>
<li>Connect the headphones to J4 (headphone) </li>
<li>Run the program, start playing a song, and observe the test result </li>
<li>Repeat the test at PLL frequencies 60, 100, 150MHz and 200 MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="McBSP3z"></a>
TEST RESULT:</h2>
<ul>
<li>The song played on the audio source should play clearly through the EVM <hr/>
</li>
</ul>
<h1><a class="anchor" id="McBSP2"></a>
McBSP EXAMPLE2 - Audio polling mode</h1>
<h2><a class="anchor" id="McBSP2x"></a>
TEST DESCRIPTION:</h2>
<p>This test verifies the operation of the C5517 McBSP (Multichannel Buffered Serial Port) module in polling mode along with the AIC3204.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSION C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="McBSP2y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5517 EVM) </li>
<li>Open the project "CSL_McBSP_Master_AIC3204_48kbps_POLL.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Connect the audio source to J9 (stereo in 1) </li>
<li>Connect the headphones to J4 (headphone) </li>
<li>Run the program, start playing a song, and observe the test result </li>
<li>Repeat the test at PLL frequencies 60, 100, 150MHz and 200 MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="McBSP2z"></a>
TEST RESULT:</h2>
<ul>
<li>The song played on the audio source should play clearly through the EVM <hr/>
 </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
